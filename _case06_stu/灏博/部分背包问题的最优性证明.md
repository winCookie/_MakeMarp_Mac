### 部分背包问题的最优性证明

▍定理  

在部分背包问题中，有 $n$ 个物品，每个物品 $i$ 有重量 $w_i$ 和价值 $v_i$，背包容量为 $C$。物品可以分割，即可以选择物品的一部分装入背包。最优解是按照物品的"性价比"（单位重量价值 $v_i/w_i$）从高到低的顺序选择物品。

▍证明（数学归纳法）  

我们使用数学归纳法证明该定理。

- **基础步骤**（$n=1$ 和 $n=2$）：  
  
  - 当 $n=1$ 时，只有一个物品，显然应该尽可能多地装入该物品，定理成立。  
  
  - 当 $n=2$ 时，设两个物品的性价比分别为 $r_1 = v_1/w_1$ 和 $r_2 = v_2/w_2$，且假设 $r_1 \geq r_2$。  
    
    比较两种选择顺序：
    
    - 先选物品1，再选物品2：总价值 $V_1 = \min(w_1, C) \cdot r_1 + \max(0, C - w_1) \cdot r_2$  
    
    - 先选物品2，再选物品1：总价值 $V_2 = \min(w_2, C) \cdot r_2 + \max(0, C - w_2) \cdot r_1$  
    
      差值 $V_1 - V_2 = \min(w_1, C) \cdot r_1 - \min(w_2, C) \cdot r_2 + \max(0, C - w_1) \cdot r_2 - \max(0, C - w_2) \cdot r_1$  
    
      由于 $r_1 \geq r_2$，可以证明 $V_1 \geq V_2$，即先选性价比高的物品更优。
  
- **归纳假设**：  
  
  假设对于 $k < n$ 个物品的情况，定理成立，即按照性价比从高到低选择是最优的。
  
- **归纳步骤**（$n$ 个物品）：  
  
  设物品已按性价比从高到低排列：$r_1 \geq r_2 \geq \dots \geq r_n$。  
  
  考虑任意不是按此顺序选择的解。如果存在相邻两个物品 $i$ 和 $i+1$ 在该解中被选择的顺序与性价比顺序相反（即先选了性价比低的物品 $i+1$ 的一部分，后选性价比高的物品 $i$ 的一部分），我们可以证明交换这两部分的选择顺序不会降低总价值。  
  
  设交换前，物品 $i$ 被选择了 $x_i$ 重量，物品 $i+1$ 被选择了 $x_{i+1}$ 重量，且 $x_i + x_{i+1} \leq w_i + w_{i+1}$。  
  
  交换后，物品 $i$ 被选择 $\min(w_i, x_i + x_{i+1})$ 重量，物品 $i+1$ 被选择 $\max(0, x_i + x_{i+1} - w_i)$ 重量。  
  
  交换前后的价值差为：  
  $$
  \Delta V = [\min(w_i, x_i + x_{i+1}) \cdot r_i + \max(0, x_i + x_{i+1} - w_i) \cdot r_{i+1}] - [x_i \cdot r_i + x_{i+1} \cdot r_{i+1}]
  $$
  
  由于 $r_i \geq r_{i+1}$，可以证明 $\Delta V \geq 0$，即交换后总价值不会减少。具体分析需考虑多种情况：
  1. 如果 $x_i + x_{i+1} \leq w_i$，则 $\Delta V = (x_i + x_{i+1})r_i - (x_i r_i + x_{i+1} r_{i+1}) = x_{i+1}(r_i - r_{i+1}) \geq 0$
  2. 如果 $x_i + x_{i+1} > w_i$，则 $\Delta V = w_i r_i + (x_i + x_{i+1} - w_i)r_{i+1} - (x_i r_i + x_{i+1} r_{i+1}) = (w_i - x_i)(r_i - r_{i+1}) \geq 0$
  
  因此，任何不按性价比顺序选择的解都可以通过交换相邻逆序对来改进，而不会降低总价值。由归纳假设，第一个位置应选择性价比最高的物品，剩余 $n-1$ 个物品也按性价比从高到低选择，故整体按性价比从高到低选择是最优的。
  
- **结论**：  
  
  由数学归纳法，定理得证。

▍算法实现  

按照性价比排序后，依次选择物品直到背包装满：

1. 计算每个物品的性价比 $r_i = v_i/w_i$
2. 按 $r_i$ 从大到小排序
3. 依次选择物品，能全选则全选，不能全选则选择部分

时间复杂度：排序 $O(n \log n)$，选择物品 $O(n)$。

▍示例  

有三个物品：  

- 物品1：重量10，价值60，性价比6  

- 物品2：重量20，价值100，性价比5  

- 物品3：重量30，价值120，性价比4  

  背包容量50。  

按性价比排序：物品1 > 物品2 > 物品3  

选择：物品1全选(10)，物品2全选(20)，物品3选20/30，总价值 = 60 + 100 + 120×(20/30) = 60 + 100 + 80 = 240（最优解）。